<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project Submission</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

  <header>
  <div class="container">
    <a href="index.html" class="logo-link">
      <div class="logo">FAIZNUTE</div>
    </a>

    <div class="menu-toggle" id="menu-toggle">☰</div>

    <nav>
      <ul id="nav-list">
        <li><a href="index.html">Home</a></li>
        <li><a href="project/projects.html">Portofolio</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
  </div>
</header>

  <main>
    <section class="login-section">
      <div id="password-gate">
        <h1>Access Project Management</h1>
        <div class="form-group">
          <label for="access-password">Password:</label>
          <input type="password" id="access-password" required>
        </div>
        <button id="access-btn">Access</button>
      </div>

      <div id="main-content" style="display: none;">
        <h1>Project Management</h1>

      <!-- Existing Projects Section -->
      <div id="existing-projects">
        <h2>Manage Existing Projects</h2>
        <div class="form-group">
          <label for="project-select">Select Project:</label>
          <select id="project-select">
            <option value="">-- Choose a project --</option>
          </select>
        </div>
        <div id="project-actions" style="display: none;">
          <button id="edit-selected" class="edit-btn">Edit Selected Project</button>
          <button id="delete-selected" class="delete-btn">Delete Selected Project</button>
          <button id="export-projects" class="edit-btn">Export Projects to JSON</button>
        </div>
      </div>

      <h2 id="form-title">Submit New Project</h2>
      <form id="project-form">
        <div class="form-group">
          <label for="title">Project Title:</label>
          <input type="text" id="title" required>
        </div>

        <div class="form-group">
          <label for="category">Category:</label>
          <select id="category" required>
            <option value="website">Website</option>
            <option value="design">Design</option>
            <option value="video">Video</option>
          </select>
        </div>

        <div class="form-group">
          <label for="tags">Tags (comma separated):</label>
          <input type="text" id="tags" placeholder="e.g. Website, UI/UX, Responsive">
        </div>

        <div class="form-group">
          <label for="thumbnail">Thumbnail Image:</label>
          <input type="file" id="thumbnail" accept="image/*" required>
        </div>

        <div class="form-group">
          <label for="description">Description:</label>
          <textarea id="description" required></textarea>
        </div>

        <div class="form-group">
          <label for="tools">Tools (comma separated):</label>
          <input type="text" id="tools" placeholder="e.g. Figma, HTML, CSS">
        </div>

        <div class="form-group">
          <label>Gallery Images:</label>
          <div id="images-container">
            <div class="image-item">
              <input type="text" placeholder="Image Title" class="image-title">
              <input type="file" accept="image/*" class="image-file">
              <button type="button" class="remove-image">Remove</button>
            </div>
          </div>
          <button type="button" id="add-image">Add Image</button>
        </div>

        <div class="form-group">
          <label>Video Links:</label>
          <div id="video-container">
            <div class="video-item">
              <input type="text" placeholder="Video Title" class="video-title">
              <input type="url" placeholder="https://..." class="video-link">
              <button type="button" class="remove-video">Remove</button>
            </div>
          </div>
          <button type="button" id="add-video">Add Video</button>
        </div>

        <button type="submit">Submit Project</button>
      </form>

      <!-- Edit Project Section -->
      <div id="edit-project" style="display: none;">
        <h2>Edit Project</h2>
        <div class="form-group">
          <label for="edit-title">Project Title:</label>
          <input type="text" id="edit-title" required>
        </div>
        <div class="form-group">
          <label for="edit-description">Description:</label>
          <textarea id="edit-description" required></textarea>
        </div>
        <button id="save-edit" class="edit-btn">Save Changes</button>
        <button id="cancel-edit" class="delete-btn">Cancel</button>
      </div>
      </div>
    </section>
  </main>

  <footer>
    <p>© 2025 FAIZNUTE. All rights reserved.</p>
  </footer>

  <script src="script.js"></script>
  <script>
    document.getElementById('access-btn').addEventListener('click', () => {
      const pass = document.getElementById('access-password').value;
      if (pass === 'faiznute') {
        document.getElementById('password-gate').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        populateProjectSelect();
      } else {
        alert('Incorrect password');
      }
    });



    // Handle adding/removing images
    const imagesContainer = document.getElementById('images-container');
    const addImageBtn = document.getElementById('add-image');

    addImageBtn.addEventListener('click', () => {
      const imageItem = document.createElement('div');
      imageItem.classList.add('image-item');
      imageItem.innerHTML = `
        <input type="text" placeholder="Image Title" class="image-title">
        <input type="file" accept="image/*" class="image-file">
        <button type="button" class="remove-image">Remove</button>
      `;
      imagesContainer.appendChild(imageItem);
    });

    imagesContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('remove-image')) {
        e.target.parentElement.remove();
      }
    });

    // Handle adding/removing videos
    const videoContainer = document.getElementById('video-container');
    const addVideoBtn = document.getElementById('add-video');

    addVideoBtn.addEventListener('click', () => {
      const videoItem = document.createElement('div');
      videoItem.classList.add('video-item');
      videoItem.innerHTML = `
        <input type="text" placeholder="Video Title" class="video-title">
        <input type="url" placeholder="https://..." class="video-link">
        <button type="button" class="remove-video">Remove</button>
      `;
      videoContainer.appendChild(videoItem);
    });

    videoContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('remove-video')) {
        e.target.parentElement.remove();
      }
    });

    // Handle form submission
    document.getElementById('project-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const title = document.getElementById('title').value;
      const category = document.getElementById('category').value;
      const tags = document.getElementById('tags').value.split(',').map(t => t.trim()).filter(t => t);
      const thumbnailFile = document.getElementById('thumbnail').files[0];
      const description = document.getElementById('description').value;
      const tools = document.getElementById('tools').value.split(',').map(t => t.trim()).filter(t => t);

      // Encode thumbnail
      const thumbnailBase64 = await fileToBase64(thumbnailFile);

      // Encode gallery images and videos
      const gallery = [];
      const imageItems = document.querySelectorAll('.image-item');
      for (let item of imageItems) {
        const titleInput = item.querySelector('.image-title');
        const fileInput = item.querySelector('.image-file');
        if (fileInput.files[0]) {
          const base64 = await fileToBase64(fileInput.files[0]);
          gallery.push({ type: 'image', title: titleInput.value, src: base64 });
        }
      }

      // Add videos
      const videoItems = document.querySelectorAll('.video-item');
      for (let item of videoItems) {
        const titleInput = item.querySelector('.video-title');
        const linkInput = item.querySelector('.video-link');
        if (titleInput.value && linkInput.value) {
          gallery.push({ type: 'video', title: titleInput.value, src: linkInput.value });
        }
      }

      const project = {
        id: title.replace(/\s+/g, '-').toLowerCase(),
        title,
        category,
        image: thumbnailBase64,
        description,
        longDescription: description, // Use description as longDescription
        date: new Date().toLocaleDateString(),
        tools,
        tags,
        gallery
      };

      // Save to localStorage
      const stored = localStorage.getItem('submittedProjects');
      const projects = stored ? JSON.parse(stored) : [];
      projects.push(project);
      localStorage.setItem('submittedProjects', JSON.stringify(projects));

      alert('Project submitted successfully!');
      populateProjectSelect();
      // Reset form
      document.getElementById('project-form').reset();
      // Clear dynamic images
      imagesContainer.innerHTML = `
        <div class="image-item">
          <input type="text" placeholder="Image Title" class="image-title">
          <input type="file" accept="image/*" class="image-file">
          <button type="button" class="remove-image">Remove</button>
        </div>
      `;
      // Clear dynamic videos
      videoContainer.innerHTML = `
        <div class="video-item">
          <input type="text" placeholder="Video Title" class="video-title">
          <input type="url" placeholder="https://..." class="video-link">
          <button type="button" class="remove-video">Remove</button>
        </div>
      `;
    });

    // Helper function to convert file to base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    let editingProject = null;
    const editProjectDiv = document.getElementById('edit-project');
    const saveEditBtn = document.getElementById('save-edit');
    const cancelEditBtn = document.getElementById('cancel-edit');

    function populateProjectSelect() {
      const select = document.getElementById('project-select');
      select.innerHTML = '<option value="">-- Choose a project --</option>';
      const stored = localStorage.getItem('submittedProjects');
      const projects = stored ? JSON.parse(stored) : [];
      projects.forEach(project => {
        const option = document.createElement('option');
        option.value = project.id;
        option.textContent = project.title;
        select.appendChild(option);
      });
    }

    document.getElementById('project-select').addEventListener('change', () => {
      const actions = document.getElementById('project-actions');
      if (document.getElementById('project-select').value) {
        actions.style.display = 'block';
      } else {
        actions.style.display = 'none';
      }
    });

    document.getElementById('edit-selected').addEventListener('click', () => {
      const id = document.getElementById('project-select').value;
      if (id) {
        editProject(id);
      }
    });

    document.getElementById('delete-selected').addEventListener('click', () => {
      const id = document.getElementById('project-select').value;
      if (id) {
        deleteProject(id);
      }
    });

    document.getElementById('export-projects').addEventListener('click', () => {
      const stored = localStorage.getItem('submittedProjects');
      const projects = stored ? JSON.parse(stored) : [];
      const json = JSON.stringify(projects, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        alert('Projects JSON copied to clipboard. Paste it into project/js/projects-data.js to replace staticProjectsData.');
      }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('Failed to copy to clipboard. Check console for JSON.');
        console.log(json);
      });
    });

    function editProject(id) {
      const stored = localStorage.getItem('submittedProjects');
      const projects = stored ? JSON.parse(stored) : [];
      editingProject = projects.find(p => p.id === id);
      if (editingProject) {
        document.getElementById('edit-title').value = editingProject.title;
        document.getElementById('edit-description').value = editingProject.description;
        editProjectDiv.style.display = 'block';
        document.getElementById('project-form').style.display = 'none';
        document.getElementById('existing-projects').style.display = 'none';
      }
    }

    function deleteProject(id) {
      if (confirm('Are you sure you want to delete this project?')) {
        const stored = localStorage.getItem('submittedProjects');
        if (stored) {
          let projects = JSON.parse(stored);
          projects = projects.filter(p => p.id !== id);
          localStorage.setItem('submittedProjects', JSON.stringify(projects));
          populateProjectSelect();
        }
      }
    }

    saveEditBtn.addEventListener('click', () => {
      if (editingProject) {
        editingProject.title = document.getElementById('edit-title').value;
        editingProject.id = editingProject.title.replace(/\s+/g, '-').toLowerCase();
        editingProject.description = document.getElementById('edit-description').value;
        const stored = localStorage.getItem('submittedProjects');
        let projects = stored ? JSON.parse(stored) : [];
        const index = projects.findIndex(p => p.id === editingProject.id);
        if (index !== -1) {
          projects[index] = editingProject;
          localStorage.setItem('submittedProjects', JSON.stringify(projects));
          alert('Project updated successfully!');
          editProjectDiv.style.display = 'none';
          document.getElementById('project-form').style.display = 'block';
          document.getElementById('existing-projects').style.display = 'block';
          populateProjectSelect();
        }
      }
    });

    cancelEditBtn.addEventListener('click', () => {
      editProjectDiv.style.display = 'none';
      document.getElementById('project-form').style.display = 'block';
      document.getElementById('existing-projects').style.display = 'block';
      populateProjectSelect();
    });


  </script>
</body>
</html>
